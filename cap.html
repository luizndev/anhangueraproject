<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Encontre sua sala na Faculdade Anhanguera de Teixeira de Freitas. Consulte hor√°rios, salas e professores.">
  <meta name="keywords" content="Anhanguera, Teixeira de Freitas, sala, hor√°rios, professores, faculdade">
  <meta name="author" content="Luis Eduardo Andrade Da Silva - T√©cnico de Inform√°tica Jr.">
  <link rel="stylesheet" href="styles/styles.css">
  <link rel="shortcut icon" href="images/favicon.svg" type="image/x-icon">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <title>Encontre sua Sala - Anhanguera Teixeira de Freitas - BA</title>
</head>
<body>
  <header class="navbar">
    <a href="#"><img src="images/logotipo.svg" alt="Logotipo"></a>
  </header>
  <section class="sectionCenter">
    <h1>QUADRO DE HOR√ÅRIOS</h1>
    <h2>FACULDADE ANHANGUERA</h2>
  </section>
  <div class="container">
    <div class="section" id="lista-section">
      <div class="headeDisplay">
        <h2 id="lista-titulo">Salas</h2>
      </div>
      <ul id="lista-opcoes"></ul>
    </div>
  </div>
  
  <div id="direcoes-container" class="hidden">
    <h2>Dire√ß√µes</h2>
    <div id="arrow-container"></div>
    <button onclick="fecharDirecoes()">Fechar</button>
  </div>

  <div id="capturar-localizacao">
    <h2>Capturar Localiza√ß√£o</h2>
    <label for="sala-nome">Nome da Sala:</label>
    <input type="text" id="sala-nome" placeholder="Digite o nome da sala">
    <button onclick="capturarLocalizacao()">Capturar</button>
    <p id="coordenadas"></p>
  </div>

  <script>
    let dados = [];
    let salasGeo = {};
    let userPosition = { latitude: 0, longitude: 0 };
    let targetPosition = { latitude: 0, longitude: 0 };
    
    function carregarDados() {
      Papa.parse('dados.csv', {
        download: true,
        header: true,
        complete: function(results) {
          dados = results.data;
          listarSalas();
        },
        error: function(error) {
          console.error('Erro ao carregar os dados:', error);
        }
      });
    }

    function carregarGeolocalizacoes() {
      fetch('salas.json')
        .then(response => response.json())
        .then(data => salasGeo = data)
        .catch(error => console.error('Erro ao carregar geolocaliza√ß√µes:', error));
    }

    function listarSalas() {
      const lista = document.getElementById('lista-opcoes');
      lista.innerHTML = '';
      
      dados.forEach(item => {
        const li = document.createElement('li');
        li.innerHTML = `${item.sala} - ${item.professor} <button onclick="iniciarNavegacao('${item.sala}')">üìç</button>`;
        lista.appendChild(li);
      });
    }

    function iniciarNavegacao(sala) {
      if (!salasGeo[sala]) {
        alert('Localiza√ß√£o da sala n√£o encontrada.');
        return;
      }
      targetPosition = salasGeo[sala];
      document.getElementById('direcoes-container').classList.remove('hidden');
      rastrearUsuario();
      renderizarSeta3D();
    }

    function fecharDirecoes() {
      document.getElementById('direcoes-container').classList.add('hidden');
    }

    function rastrearUsuario() {
      if (navigator.geolocation) {
        navigator.geolocation.watchPosition(position => {
          userPosition.latitude = position.coords.latitude;
          userPosition.longitude = position.coords.longitude;
          atualizarDirecao();
        }, error => {
          console.error('Erro ao obter localiza√ß√£o:', error);
        });
      } else {
        alert('Geolocaliza√ß√£o n√£o suportada no seu navegador.');
      }
    }

    function calcularAngulo() {
      let deltaY = targetPosition.latitude - userPosition.latitude;
      let deltaX = targetPosition.longitude - userPosition.longitude;
      return Math.atan2(deltaY, deltaX) * (180 / Math.PI);
    }

    function atualizarDirecao() {
      let angulo = calcularAngulo();
      document.querySelector('#arrow-container canvas').style.transform = `rotate(${angulo}deg)`;
    }

    function renderizarSeta3D() {
      const container = document.getElementById('arrow-container');
      container.innerHTML = '';
      
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
      const renderer = new THREE.WebGLRenderer();
      renderer.setSize(200, 200);
      container.appendChild(renderer.domElement);
      
      const geometry = new THREE.ConeGeometry(0.5, 1, 32);
      const material = new THREE.MeshBasicMaterial({ color: 0xff0000 });
      const arrow = new THREE.Mesh(geometry, material);
      scene.add(arrow);
      
      camera.position.z = 3;
      
      function animate() {
        requestAnimationFrame(animate);
        arrow.rotation.y = calcularAngulo() * (Math.PI / 180);
        renderer.render(scene, camera);
      }
      animate();
    }

    function capturarLocalizacao() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(position => {
          const latitude = position.coords.latitude;
          const longitude = position.coords.longitude;
          document.getElementById('coordenadas').innerText = `Latitude: ${latitude}, Longitude: ${longitude}`;
        }, error => {
          console.error('Erro ao capturar localiza√ß√£o:', error);
        });
      } else {
        alert('Geolocaliza√ß√£o n√£o suportada no seu navegador.');
      }
    }

    window.onload = function() {
      carregarDados();
      carregarGeolocalizacoes();
    };
  </script>
</body>
</html>
